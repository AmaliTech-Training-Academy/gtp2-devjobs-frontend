<div class="forgot-password-container">
  <app-public-auth-navbar></app-public-auth-navbar>

  <div class="forgot-password-content">
    <!-- Left Section with helpful info -->
    <div class="left-section">
      <div class="content-list">
        <ng-container [ngSwitch]="stage">
          <!-- Stage 1 and 2 Info -->
          <ng-container *ngSwitchCase="'email'">
            <p>Enter the email address you used to sign up to receive a link to reset your password.</p>
            <p>Check your spam or junk folder if you didn’t receive email, or wait a few minutes before trying again.</p>
            <p>If the link has expired, simply request a new one from this page.</p>
          </ng-container>

          <ng-container *ngSwitchCase="'sent'">
            <p>Check your spam or junk folder if you didn’t receive email, or wait a few minutes before trying again.</p>
            <p>If the link has expired, simply request a new one from this page.</p>
          </ng-container>

          <!-- Stage 3 Info -->
          <ng-container *ngSwitchCase="'new-password'">
            <p>Passwords are case-sensitive — check your caps lock.</p>
            <p>Your password must have:</p>
            <ul>
              <li>Use at least 8 characters</li>
              <li>Use upper and lower case characters</li>
              <li>Use 1 or more numbers</li>
              <li>Use special characters</li>
            </ul>
          </ng-container>

          <!-- Stage 4 -->
          <ng-container *ngSwitchCase="'success'">
            <p>Your password was updated successfully. You can now log in with your new password.</p>
          </ng-container>
        </ng-container>
      </div>

      <div class="decorative-shape">
        <img src="./assets/icons/image 6.png" alt="" />
      </div>
    </div>

    <!-- Right Section with Form -->
    <div class="right-section">
      <div class="form-container">
        <button mat-button class="back-btn" *ngIf="stage !== 'email'" (click)="goBack()">← Go Back</button>

        <h2 class="form-title" *ngIf="stage === 'email'">Reset your password</h2>
        <h2 class="form-title" *ngIf="stage === 'sent'">Reset link has been sent</h2>
        <h2 class="form-title" *ngIf="stage === 'new-password'">Set new password</h2>
        <h2 class="form-title" *ngIf="stage === 'success'">Password set successfully</h2>

        <form [formGroup]="form" (ngSubmit)="onSubmit()" *ngIf="stage !== 'success'" class="auth-form">
          <!-- Stage 1: Email Form -->
          <ng-container *ngIf="stage === 'email'">
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Email Address</mat-label>
              <input
                matInput
                type="email"
                formControlName="email"
                placeholder="Enter your email"
              />
              <mat-icon matPrefix><img src="./assets/icons/email.png" alt="email" /></mat-icon>
              <mat-error *ngIf="form.get('email')?.invalid && form.get('email')?.touched">
                Please enter a valid email address
              </mat-error>
            </mat-form-field>
            <button mat-raised-button color="primary" type="submit" [disabled]="form.get('email')?.invalid">
              Reset Password
            </button>
          </ng-container>

          <!-- Stage 3: New Password -->
          <ng-container *ngIf="stage === 'new-password'">
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>New Password</mat-label>
              <input
                matInput
                [type]="hide ? 'password' : 'text'"
                formControlName="password"
                placeholder="Enter new password"
              />
              <button mat-icon-button matSuffix (click)="hide = !hide" type="button">
                <mat-icon>{{ hide ? "visibility_off" : "visibility" }}</mat-icon>
              </button>
              <mat-error *ngIf="form.get('password')?.invalid && form.get('password')?.touched">
                Minimum 8 characters with mix of upper, lower, numbers, symbols.
              </mat-error>
            </mat-form-field>

            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Confirm Password</mat-label>
              <input
                matInput
                [type]="hide ? 'password' : 'text'"
                formControlName="confirmPassword"
                placeholder="Confirm new password"
              />
              <button mat-icon-button matSuffix (click)="hide = !hide" type="button">
                <mat-icon>{{ hide ? "visibility_off" : "visibility" }}</mat-icon>
              </button>
              <mat-error
                *ngIf="form.get('confirmPassword')?.value !== form.get('password')?.value"
              >
                Passwords do not match
              </mat-error>
            </mat-form-field>

            <button
              mat-raised-button
              color="primary"
              type="submit"
              [disabled]="
                form.get('password')?.invalid ||
                form.get('confirmPassword')?.value !== form.get('password')?.value
              "
            >
              Submit
            </button>
          </ng-container>
        </form>

        <!-- Stage 2: Link Sent -->
        <div *ngIf="stage === 'sent'" class="link-sent">
          <button mat-flat-button color="primary" (click)="goToEmail()">Go to email</button>
        </div>

        <!-- Stage 4: Success -->
        <div *ngIf="stage === 'success'" class="success-message">
          <button mat-raised-button color="primary" routerLink="/login">Login</button>
        </div>
      </div>
    </div>
  </div>
</div>
