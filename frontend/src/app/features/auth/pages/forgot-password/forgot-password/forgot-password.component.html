<div class="forgot-password-container">
  <app-public-auth-navbar></app-public-auth-navbar>

  <div class="forgot-password-content">
    <!-- Left Section with helpful info -->
    <div class="left-section">
      <div class="content-list">
        <ng-container [ngSwitch]="stage">
          <!-- Stage 1: Email -->
          <ng-container *ngSwitchCase="'email'">
            <div class="content-item">
              <div class="icon">
                <img src="./assets/icons/bulb.png" alt="lamp-icon" />
              </div>
              <div class="text">
                Enter the email address you used to sign up to receive a link to
                reset your password.
              </div>
            </div>

            <div class="content-item">
              <div class="icon">
                <img src="./assets/icons/bulb.png" alt="lamp-icon" />
              </div>
              <div class="text">
                Check your spam or junk folder if you didn't receive email, or
                wait a few minutes before trying again.
              </div>
            </div>

            <div class="content-item">
              <div class="icon">
                <img src="./assets/icons/bulb.png" alt="lamp-icon" />
              </div>
              <div class="text">
                If the link has expired, simply request a new one from this
                page.
              </div>
            </div>
          </ng-container>

          <!-- Stage 2: Sent -->
          <ng-container *ngSwitchCase="'sent'">
            <div class="content-item">
              <div class="icon">
                <img src="./assets/icons/bulb.png" alt="lamp-icon" />
              </div>
              <div class="text">
                Check your spam or junk folder if you didn't receive email, or
                wait a few minutes before trying again.
              </div>
            </div>

            <div class="content-item">
              <div class="icon">
                <img src="./assets/icons/bulb.png" alt="lamp-icon" />
              </div>
              <div class="text">
                If the link has expired, simply request a new one from this
                page.
              </div>
            </div>
          </ng-container>

          <!-- Stage 3: New Password -->
          <ng-container *ngSwitchCase="'new-password'">
            <div class="content-item">
              <div class="icon">
                <img src="./assets/icons/bulb.png" alt="lamp-icon" />
              </div>
              <div class="text">
                Passwords are case-sensitive â€” check your caps lock.
              </div>
            </div>

            <div class="content-item">
              <div class="icon">
                <img src="./assets/icons/bulb.png" alt="lamp-icon" />
              </div>
              <div class="text">Your password must have:</div>
            </div>

            <div class="content-list">
              <div class="content-item">
                <div class="icon">
                  <img src="./assets/icons/ellipse.png" alt="ellipse-icon" />
                </div>
                <div class="text">Use at least 8 characters</div>
              </div>

              <div class="content-item">
                <div class="icon">
                  <img src="./assets/icons/ellipse.png" alt="ellipse-icon" />
                </div>
                <div class="text">Use upper and lower case characters</div>
              </div>

              <div class="content-item">
                <div class="icon">
                  <img src="./assets/icons/ellipse.png" alt="ellipse-icon" />
                </div>
                <div class="text">Use 1 or more numbers</div>
              </div>

              <div class="content-item">
                <div class="icon">
                  <img src="./assets/icons/ellipse.png" alt="ellipse-icon" />
                </div>
                <div class="text">Use special characters</div>
              </div>
            </div>
          </ng-container>

          <!-- Stage 4: Success -->
          <ng-container *ngSwitchCase="'success'">
            <div class="content-item">
              <div class="icon">
                <img src="./assets/icons/bulb.png" alt="lamp-icon" />
              </div>
              <div class="text">
                Your password was updated successfully. You can now log in with
                your new password.
              </div>
            </div>
          </ng-container>
        </ng-container>
      </div>

      <div class="decorative-shape">
        <img src="./assets/icons/image 6.png" alt="" />
      </div>
    </div>

    <!-- Right Section with Form -->
    <div class="right-section">
      <div class="form-container">
        <!-- Form Title Container -->
        <div class="form-title">
          <app-back-button
            class="go-back"
            mat-button
            *ngIf="
              stage === 'email' || stage === 'sent' || stage === 'new-password'
            "
            (click)="goBack()"
          ></app-back-button>

          <div class="form-wrapper">
            <span *ngIf="stage === 'email'">Reset your password</span>
            <span *ngIf="stage === 'sent'">Reset link has been sent</span>
            <span *ngIf="stage === 'new-password'">Set new password</span>
            <span *ngIf="stage === 'success'">Password set successfully</span>

            <!-- Auth Form -->
            <div class="auth-form">
              <form
                [formGroup]="form"
                (ngSubmit)="onSubmit()"
                *ngIf="stage !== 'success' && stage !== 'sent'"
              >
                <!-- Stage 1: Email Form -->
                <ng-container *ngIf="stage === 'email'">
                  <div class="form-group">
                    <label for="email" class="form-label">Email Address</label>
                    <mat-form-field appearance="outline" class="full-width">
                      <input
                        matInput
                        type="email"
                        id="email"
                        formControlName="email"
                        placeholder="Enter your email"
                      />
                      <mat-icon matPrefix>
                        <img src="./assets/icons/email.png" alt="email" />
                      </mat-icon>
                      <mat-error
                        *ngIf="
                          form.get('email')?.invalid &&
                          form.get('email')?.touched
                        "
                      >
                        Please enter a valid email address
                      </mat-error>
                    </mat-form-field>
                  </div>
                  <button
                    mat-raised-button
                    color="primary"
                    type="submit"
                    [disabled]="form.get('email')?.invalid || isLoading"
                    class="submit-button"
                  >
                    <mat-spinner *ngIf="isLoading" diameter="20" color="accent">
                    </mat-spinner>
                    <span *ngIf="!isLoading">Reset Password</span>
                  </button>
                </ng-container>

                <!-- Stage 3: New Password -->
                <ng-container *ngIf="stage === 'new-password'">
                  <div class="form-group">
                    <label for="password" class="form-label"
                      >New Password</label
                    >
                    <mat-form-field appearance="outline" class="full-width">
                      <input
                        matInput
                        [type]="hide ? 'password' : 'text'"
                        id="password"
                        formControlName="password"
                        placeholder="Enter new password"
                      />
                      <button
                        mat-icon-button
                        matSuffix
                        (click)="hide = !hide"
                        type="button"
                        [attr.aria-label]="'Hide password'"
                        [attr.aria-pressed]="hide"
                      >
                        <mat-icon>{{
                          hide ? "visibility_off" : "visibility"
                        }}</mat-icon>
                      </button>
                      <mat-error
                        *ngIf="
                          form.get('password')?.invalid &&
                          form.get('password')?.touched
                        "
                      >
                        Password must contain at least 8 characters with
                        uppercase, lowercase, numbers, and special characters.
                      </mat-error>
                    </mat-form-field>
                  </div>

                  <div class="form-group">
                    <label for="confirmPassword" class="form-label"
                      >Confirm Password</label
                    >
                    <mat-form-field appearance="outline" class="full-width">
                      <input
                        matInput
                        [type]="hide ? 'password' : 'text'"
                        id="confirmPassword"
                        formControlName="confirmPassword"
                        placeholder="Confirm new password"
                      />
                      <button
                        mat-icon-button
                        matSuffix
                        (click)="hide = !hide"
                        type="button"
                        [attr.aria-label]="'Hide password'"
                        [attr.aria-pressed]="hide"
                      >
                        <mat-icon>{{
                          hide ? "visibility_off" : "visibility"
                        }}</mat-icon>
                      </button>
                      <mat-error
                        *ngIf="
                          form.get('confirmPassword')?.invalid &&
                          form.get('confirmPassword')?.touched
                        "
                      >
                        Passwords do not match
                      </mat-error>
                    </mat-form-field>
                  </div>

                  <button
                    mat-raised-button
                    color="primary"
                    type="submit"
                    [disabled]="form.invalid || isLoading"
                    class="submit-button"
                  >
                    <mat-spinner *ngIf="isLoading" diameter="20" color="accent">
                    </mat-spinner>
                    <span *ngIf="!isLoading">Update Password</span>
                  </button>
                </ng-container>
              </form>

              <!-- Stage 2: Link Sent -->
              <div *ngIf="stage === 'sent'" class="link-sent">
                <div class="sent-message">
                  <p>
                    We've sent a password reset link to your email address.
                    Please check your inbox and follow the instructions to reset
                    your password.
                  </p>
                </div>
                <button
                  mat-flat-button
                  color="primary"
                  (click)="goToEmail()"
                  class="submit-button"
                >
                  Go to Email
                </button>
                <button
                  mat-button
                  (click)="stage = 'email'"
                  class="secondary-button"
                >
                  Send Another Link
                </button>
              </div>

              <!-- Stage 4: Success -->
              <div *ngIf="stage === 'success'" class="success-message">
                <div class="success-content">
                  <mat-icon class="success-icon">check_circle</mat-icon>
                  <p>Your password has been successfully updated!</p>
                </div>
                <button
                  mat-raised-button
                  color="primary"
                  routerLink="/login"
                  class="submit-button"
                >
                  Continue to Login
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
